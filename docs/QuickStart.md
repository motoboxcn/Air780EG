# 快速开始指南

## 概述

本指南将帮助你快速开始使用Air780EG库，了解基本的配置和使用流程。

## 前置准备

### 硬件要求
- ESP32或ESP32-S3开发板
- Air780EG模块
- SIM卡（已激活数据服务）
- 稳定的电源供应（推荐3.7V锂电池或5V适配器）

### 硬件连接
```
ESP32-S3    Air780EG
GPIO16  ->  TXD
GPIO17  ->  RXD
GND     ->  GND
3.3V    ->  VCC
GPIO18  ->  RESET (可选)
GPIO19  ->  POWER (可选)
```

### 软件环境
- PlatformIO IDE 或 Arduino IDE
- ESP32开发环境已配置
- Air780EG库已安装

## 基本使用流程

### 1. 库的引入和初始化

Air780EG库采用模块化设计，主要包含以下组件：
- **Core**: AT指令核心通信
- **Network**: 网络管理
- **GNSS**: 定位服务
- **MQTT**: 消息队列

### 2. 模块初始化顺序

1. **串口初始化**: 配置与Air780EG的通信串口
2. **模块上电**: 启动Air780EG模块
3. **网络注册**: 等待网络连接
4. **功能启用**: 根据需要启用GNSS、MQTT等功能

### 3. 主循环维护

在主循环中必须调用 `air780.loop()` 来维护所有功能模块的状态更新。

## 功能模块说明

### 网络管理 (Network)
- **功能**: 管理蜂窝网络连接、信号监测、运营商信息
- **使用场景**: 所有需要网络连接的应用
- **注意事项**: 网络注册可能需要几秒到几分钟时间

### GNSS定位 (GNSS)
- **功能**: GPS/北斗定位、位置信息获取
- **使用场景**: 车辆跟踪、位置服务、导航应用
- **注意事项**: 
  - 首次定位可能需要较长时间（冷启动）
  - 室内环境定位效果差
  - v1.2.1版本移除了自动WiFi/LBS切换

### MQTT客户端 (MQTT)
- **功能**: 消息发布订阅、远程通信
- **使用场景**: IoT数据上传、远程控制、实时通信
- **注意事项**: 需要先建立网络连接

## 定位策略 (v1.2.1重要变更)

### 变更说明
从v1.2.1开始，库不再自动进行WiFi/LBS定位切换，用户需要手动控制。

### 推荐策略
1. **优先使用GNSS**: 适合移动场景，精度高
2. **WiFi定位**: 适合城市固定位置，室内环境
3. **LBS定位**: 作为最后备选，覆盖范围广但精度低

### 使用建议
- **移动车辆**: 主要依赖GNSS，信号丢失时等待恢复
- **固定设备**: 可在GNSS失效时手动切换到WiFi定位
- **紧急情况**: 使用LBS定位作为最后手段

## 配置参数

### 串口配置
- **波特率**: 115200 (默认)
- **数据位**: 8
- **停止位**: 1
- **校验位**: 无

### GNSS配置
- **更新频率**: 0.1Hz - 10Hz (推荐1Hz)
- **定位模式**: GPS+北斗 (默认)
- **辅助定位**: 手动控制

### MQTT配置
- **协议版本**: MQTT 3.1.1
- **QoS等级**: 0, 1, 2
- **心跳间隔**: 60秒 (默认)
- **自动重连**: 支持

## 性能优化

### 缓存机制
库使用智能缓存避免重复AT指令调用：
- 网络状态每5秒更新一次
- GNSS数据按设定频率更新
- 所有get方法返回缓存数据

### 更新频率调整
```cpp
// 网络状态更新间隔 (毫秒)
air780.getNetwork().setUpdateInterval(10000);

// GNSS更新频率 (Hz)
air780.getGNSS().setUpdateFrequency(2.0);
```

### 内存管理
- 避免频繁的字符串操作
- 合理设置缓存大小
- 定期检查内存使用情况

## 调试和故障排除

### 日志级别设置
```cpp
// 设置日志级别
Air780EG::setLogLevel(AIR780EG_LOG_DEBUG);
Air780EG::setLogOutput(&Serial);
```

### 常见问题

1. **模块无响应**
   - 检查串口连接
   - 确认电源供应
   - 尝试硬件复位

2. **网络注册失败**
   - 检查SIM卡状态
   - 确认信号强度
   - 检查APN设置

3. **GNSS无法定位**
   - 确保在开阔环境
   - 等待足够时间
   - 检查天线连接

4. **MQTT连接失败**
   - 检查网络状态
   - 确认服务器配置
   - 检查防火墙设置

### 调试工具
- 串口监视器查看AT指令交互
- 网络信号强度监测
- GNSS卫星状态查询
- MQTT连接状态检查

## 示例项目

库提供了多个示例项目：

- `BasicModem`: 基本功能演示
- `MqttClient`: MQTT客户端使用
- `GNSSTest`: GNSS定位测试
- `ManualLocationControl`: 手动定位控制 (v1.2.1新增)

## 最佳实践

### 1. 初始化顺序
按照网络 -> GNSS -> MQTT的顺序初始化功能模块

### 2. 错误处理
对所有关键操作进行错误检查和处理

### 3. 资源管理
合理使用定时器和缓存，避免资源浪费

### 4. 定位策略
根据应用场景选择合适的定位方式

### 5. 网络管理
监控网络状态，实现自动重连机制

## 进阶使用

### 自定义配置
- APN设置
- SSL/TLS配置
- 自定义AT指令

### 扩展功能
- 短信收发
- 语音通话
- 文件传输

### 性能调优
- 功耗优化
- 响应速度优化
- 内存使用优化

## 技术支持

- **文档**: 查看 `docs/` 目录下的详细文档
- **示例**: 参考 `examples/` 目录下的示例代码
- **问题反馈**: 在GitHub仓库提交Issue
- **社区支持**: 参与项目讨论和贡献

## 下一步

1. 查看具体的API文档了解详细接口
2. 运行示例项目熟悉基本用法
3. 根据项目需求定制功能配置
4. 参考最佳实践优化应用性能
